# RoboMaster软件设计模式

RoboMaster机器人上的软件开发具有很多设计模式，这里简单介绍一种设计模式，可供参考。

### 1.任务分层

对系统按功能进行解耦，每个功能作为单独一个节点，可大概分出三种类型的节点/任务。

* 控制任务/通信任务：

  * 单板计算机（NUC）控制机器人实际上是通过通信完成的，具体实现实际上是在mcu（stm32）上。主要任务是接收其他节点的控制指令，发送来自mcu的传感器数据（如陀螺仪，电机编码器，裁判系统数据等）给其他节点。
  * 实时性要求高
* 对应rmoss_core/rm_base模块
* 功能任务：

  * 机器人核心功能任务，如自动瞄准，能量机关等等，这些任务一般相互独立，可以解耦成独立模块，这些模块的输入来自于传感器（相机，来自rm_base的底层数据等），然后将结果与控制指令发送给rm_base或决策模块。
* 实时性要求较高（通过增加预测滤波进行补偿）
  * 对应rmoss_contrib/task_auto_aim等模块
* 决策任务：
  * 对于全自动机器人，需要一个决策节点，负责全局的决策，以及对其他功能任务节点进行管理，如如设备监控节点，预警节点，信息记录节点。决策任务赋予机器人智能，使得机器人更好的人机交互或自主行动。
  * 实时性要求低

### 2..微服务架构

在对系统进行解耦后，这些节点需要一起工作，实现最终的系统，为了方便这些节点可以有条不紊的一起工作，采用微服务架构，即除了决策任务的其他任务，都作为一项服务，通过决策任务管理并控制这些任务。

* 控制任务/功能任务采用service方式，对外提供服务。

* 决策任务通过service控制并管理这些服务，使得决策节点获得这些服务的能力。