# RMOSS软件设计模式

RoboMaster机器人的上层软件开发具有很多设计模式，这里简单介绍一种设计模式，可供参考。

### 1. 模块化解耦

对于一个RM机器人，可能需要实现多种功能，从系统的角度来说，RM机器人软件系统是一个复杂系统，需要对其进行解耦模块化，才能高效进行开发。

* 按照功能对系统进行解耦，每个功能作为单独一个节点，即模块化解耦：如自瞄功能模块，能量机关功能模块，自动防御功能模块等

### 2. 任务分层

模块化解耦后，需要对这些模块进行分层，根据任务流程可分为三种任务类型，

**控制任务** ：面向机器人底层，负责处理机器人传感器数据与执行指令数据

* 单板计算机（NUC）控制机器人实际上是通过通信完成的，具体实现实际上是在mcu（stm32）上。主要任务是接收其他节点的控制指令，发送来自mcu的传感器数据（如陀螺仪，电机编码器，裁判系统数据等）给其他节点。
* 实时性要求高
* 对应rmoss_core/rmoss_base模块，rmoss_core/rmoss_cam等模块

**功能任务** ：面向机器人子任务实现，一般每个子任务之间相互独立。

* 机器人核心功能任务，如自动瞄准，能量机关等等，这些任务一般相互独立，可以解耦成独立模块，这些模块的输入来自于传感器（相机，来自rmoss_base的底层数据等），然后将结果与控制指令发送给rmoss_base或决策模块。
* 实时性要求较高（通过增加预测滤波进行补偿）
* 对应rmoss_contrib/rmoss_auto_aim，rmoss_contrib/rmoss_poswer_rune2019等模块

**决策任务** ：面向机器人全局决策，管理并利用控制任务与功能任务的模块节点，实现机器人的整体功能。

* 对于全自动机器人，需要一个决策节点，负责全局的决策，以及对其他功能任务节点进行管理，如如设备监控节点，预警节点，信息记录节点。决策任务赋予机器人智能，使得机器人更好的人机交互或自主行动。
* 实时性要求低

### 3. C/S服务架构

在对系统进行解耦分层后，这些节点需要一起工作，实现最终的系统，为了方便这些节点可以有条不紊的一起工作，采用C/S服务架构，即除了决策任务的其他任务，都作为一项服务，通过决策任务管理并控制这些任务。

* 控制任务/功能任务采用service方式，对外提供服务。

* 决策任务通过service控制并管理这些服务，使得决策节点获得这些服务的能力。